--- ./original/entrypoint.sh	2025-12-17 22:07:09.000000000 +0300
+++ ./entrypoint.sh	2026-01-04 17:10:12.254017720 +0300
@@ -39,6 +39,10 @@
   fi
 fi
 
+# –≠—Ç–∞ —Å—Å—ã–ª–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.
+# –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç ‚Äî –∑–Ω–∞—á–∏—Ç, –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –µ—Å—Ç—å.
+HEALTH_CHECK_URL="${HEALTH_CHECK_URL:-https://www.gstatic.com/generate_204  }"
+
 DEFAULT_CONFIG=$(cat << 'EOF'
 external-controller: $EXTERNAL_CONTROLLER_ADDRESS:$UI_PORT
 external-ui: $EXTERNAL_UI_PATH
@@ -56,6 +60,7 @@
 
 proxy-providers:
 $PROVIDERS_BLOCK
+$PROVIDERS_CHAIN_BLOCK
 
 proxy-groups:
   - name: SELECTOR
@@ -305,8 +310,48 @@
 "
 }
 
+# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ HTTP (SUB1, SUB2 –∏ —Ç.–¥.)
+add_http_provider() {
+    local name="$1"
+    local url="$2"
+    PROVIDERS_BLOCK="${PROVIDERS_BLOCK}  ${name}:
+    type: http
+    url: \"${url}\"
+    interval: 3600
+    health-check:
+      enable: true
+      url: \"${HEALTH_CHECK_URL}\"
+      interval: 3600
+"
+    PROVIDERS_LIST="${PROVIDERS_LIST}      - ${name}
+"
+}
+
+# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è "—Ü–µ–ø–æ—á–µ–∫": –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã ‚Üí —á–µ—Ä–µ–∑ —Ä–æ—Å—Å–∏–π—Å–∫–∏–π –ø—Ä–æ–∫—Å–∏
+# –≠—Ç–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç —Ç—Ä–∞—Ñ–∏–∫ —á–µ—Ä–µ–∑ RU_AUTO
+add_http_chain_provider() {
+    local name="$1"
+    local url="$2"
+    local chain_name="${name}-via-ru"
+    PROVIDERS_CHAIN_BLOCK="${PROVIDERS_CHAIN_BLOCK}  ${chain_name}:
+    type: http
+    url: \"${url}\"
+    interval: 3600
+    override:
+      dialer-proxy: RU_AUTO         # –°–Ω–∞—á–∞–ª–∞ –∏–¥—ë–º —á–µ—Ä–µ–∑ RU_AUTO
+      exclude-filter: \"(?i)üá∑üá∫|RU\" # –ò—Å–∫–ª—é—á–∞–µ–º RU —á—Ç–æ–±—ã –Ω–µ —Ö–æ–¥–∏—Ç—å –ø–µ—Ç–ª—è–º–∏
+      exclude-type: wireguard       # –ò—Å–∫–ª—é—á–∞–µ–º AWG/WARP ‚Äî –æ–Ω–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ü–µ–ø–æ—á–∫–∏
+"
+    PROVIDERS_CHAIN_LIST="${PROVIDERS_CHAIN_LIST}      - ${chain_name}
+"
+}
+
+# –û–±–Ω—É–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –¥–∞–ª—å—à–µ
 PROVIDERS_BLOCK=""
 PROVIDERS_LIST=""
+PROVIDERS_CHAIN_BLOCK=""
+PROVIDERS_CHAIN_LIST=""
+
 ####
 srv_file="$WORKDIR/srv.yaml"
 if env | grep -qE '^(SRV)[0-9]'; then
@@ -341,25 +386,22 @@
 while IFS='=' read -r name value; do
   case "$name" in
     SUB[0-9]*)
-      PROVIDERS_BLOCK="${PROVIDERS_BLOCK}  ${name}:
-    url: \"${value}\"
-    type: http
-    interval: 86400
-    health-check:
-      enable: true
-      url: \"${HEALTH_CHECK_URL}\"
-      interval: 86400
-"
-    PROVIDERS_LIST="${PROVIDERS_LIST}      - $(echo "$name")
-"
+      # –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º –∫–∞–≤—ã—á–∫–∏ –≤ URL, —á—Ç–æ–±—ã YAML –Ω–µ —Å–ª–æ–º–∞–ª—Å—è
+      value_clean=$(printf '%s' "$value" | sed 's/"/\\"/g')
+      # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—ã—á–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
+      add_http_provider "$name" "$value_clean"
+      # –î–æ–±–∞–≤–ª—è–µ–º —Ü–µ–ø–æ—á–∫—É –¥–ª—è —ç—Ç–æ–≥–æ –∂–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
+      add_http_chain_provider "$name" "$value_clean"
       ;;
   esac
-done <<EOF
+done << EOF
 $(env)
 EOF
 
 export PROVIDERS_BLOCK
 export PROVIDERS_LIST
+export PROVIDERS_CHAIN_BLOCK
+export PROVIDERS_CHAIN_LIST
 
 envsubst < "$TEMPLATE_DIR/$CONFIG" > "$WORKDIR/$CONFIG"
 
